@{
    ViewData["Title"] = "T·ªïng quan";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<link rel="stylesheet" href="~/admin/css/dashboard.css" />

<!-- REVENUE STATS ROW -->
<div class="stats-grid" style="margin-bottom: 20px;">
    <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #10b981, #059669);">üí∞</div>
        <div class="stat-info">
            <h3>@(((decimal)ViewBag.TodayRevenue).ToString("N0"))‚Ç´</h3>
            <p>Doanh thu h√¥m nay</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);">üìä</div>
        <div class="stat-info">
            <h3>@(((decimal)ViewBag.MonthRevenue).ToString("N0"))‚Ç´</h3>
            <p>Doanh thu th√°ng n√†y</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #8b5cf6, #6d28d9);">üíé</div>
        <div class="stat-info">
            <h3>@(((decimal)ViewBag.TotalRevenue).ToString("N0"))‚Ç´</h3>
            <p>T·ªïng doanh thu</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">üë•</div>
        <div class="stat-info">
            <h3>@ViewBag.TotalUser</h3>
            <p>Ng∆∞·ªùi d√πng</p>
        </div>
    </div>
</div>

<!-- ENTITY STATS ROW -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon primary">üìÇ</div>
        <div class="stat-info">
            <h3>@ViewBag.TotalCategory</h3>
            <p>Danh m·ª•c</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon success">üçï</div>
        <div class="stat-info">
            <h3>@ViewBag.TotalFood</h3>
            <p>M√≥n ƒÉn</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon warning">üéÅ</div>
        <div class="stat-info">
            <h3>@ViewBag.TotalCombo</h3>
            <p>Combo</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon danger">üßæ</div>
        <div class="stat-info">
            <h3>@ViewBag.TotalOrder</h3>
            <p>ƒê∆°n h√†ng</p>
        </div>
    </div>
</div>

<!-- ORDER STATUS CARDS -->
<div class="stats-grid" style="margin-top: 20px;">
    <div class="stat-card" style="border-left: 4px solid #f59e0b;">
        <div class="stat-info">
            <h3 style="color: #f59e0b;">@ViewBag.PendingOrders</h3>
            <p>‚è≥ Ch·ªù x·ª≠ l√Ω</p>
        </div>
    </div>
    <div class="stat-card" style="border-left: 4px solid #3b82f6;">
        <div class="stat-info">
            <h3 style="color: #3b82f6;">@ViewBag.DeliveringOrders</h3>
            <p>üöö ƒêang giao</p>
        </div>
    </div>
    <div class="stat-card" style="border-left: 4px solid #10b981;">
        <div class="stat-info">
            <h3 style="color: #10b981;">@ViewBag.CompletedOrders</h3>
            <p>‚úÖ Ho√†n th√†nh</p>
        </div>
    </div>
    <div class="stat-card" style="border-left: 4px solid #ef4444;">
        <div class="stat-info">
            <h3 style="color: #ef4444;">@ViewBag.CancelledOrders</h3>
            <p>‚ùå ƒê√£ h·ªßy</p>
        </div>
    </div>
</div>

<div class="row g-4" style="margin-top: 10px;">
    <!-- REVENUE CHART -->
    <div class="col-lg-8">
        <div class="admin-table-card p-4">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="font-size: 1.1rem; font-weight: 600; margin: 0;">üìà Doanh thu 7 ng√†y g·∫ßn nh·∫•t</h3>
            </div>
            <div style="position: relative; height: 300px; width: 100%;">
                <canvas id="revenueChart"></canvas>
            </div>
        </div>
    </div>

    <!-- TOP PRODUCTS -->
    <div class="col-lg-4">
        <div class="admin-table-card p-4 h-100">
            <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 20px;">üèÜ Top m√≥n b√°n ch·∫°y</h3>
            <div class="top-products-list">
                @if (ViewBag.TopFoods != null)
                {
                    var rank = 1;
                    foreach (var food in ViewBag.TopFoods)
                    {
                        var medal = rank == 1 ? "ü•á" : (rank == 2 ? "ü•à" : (rank == 3 ? "ü•â" : $"#{rank}"));
                        <div class="top-product-item">
                            <span class="rank">@medal</span>
                            <span class="name">@food.Name</span>
                            <span class="qty">@food.Quantity</span>
                        </div>
                        rank++;
                    }
                }
            </div>
        </div>
    </div>
</div>

<div class="row g-4" style="margin-top: 10px;">
    <!-- CATEGORY CHART -->
    <div class="col-lg-5">
        <div class="admin-table-card p-4 h-100">
            <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 20px;">üçï M√≥n ƒÉn theo danh m·ª•c</h3>
            <div style="position: relative; height: 280px; width: 100%;">
                <canvas id="foodChart"></canvas>
            </div>
        </div>
    </div>

    <!-- RECENT ORDERS -->
    <div class="col-lg-7">
        <div class="admin-table-card h-100">
            <div class="table-header">
                <h3>üßæ ƒê∆°n h√†ng m·ªõi nh·∫•t</h3>
                <a href="/Admin/Order" class="btn-admin sm outline">Xem t·∫•t c·∫£</a>
            </div>
            
            <div class="table-responsive">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>M√£ ƒë∆°n</th>
                            <th>Kh√°ch h√†ng</th>
                            <th>T·ªïng ti·ªÅn</th>
                            <th>Tr·∫°ng th√°i</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var o in ViewBag.LatestOrders)
                        {
                            <tr>
                                <td><span class="id-badge">@o.OrderCode</span></td>
                                <td>@(o.Customer?.FullName ?? "N/A")</td>
                                <td class="fw-bold">@o.TotalAmount.ToString("N0")‚Ç´</td>
                                <td>
                                    @{
                                        var statusClass = "info";
                                        var statusText = o.Status;
                                        if (o.Status == "Completed") { statusClass = "success"; statusText = "Ho√†n th√†nh"; }
                                        else if (o.Status == "Cancelled") { statusClass = "danger"; statusText = "ƒê√£ h·ªßy"; }
                                        else if (o.Status == "Pending") { statusClass = "warning"; statusText = "Ch·ªù x·ª≠ l√Ω"; }
                                        else if (o.Status == "Delivering") { statusClass = "info"; statusText = "ƒêang giao"; }
                                    }
                                    <span class="badge-admin @statusClass">@statusText</span>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
</div>
</div>

@section Scripts {
    <script>
        // REVENUE CHART - 7 days
        fetch('/Admin/Dashboard/RevenueByDate')
            .then(res => res.json())
            .then(data => {
                const ctx = document.getElementById('revenueChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.map(d => d.date),
                        datasets: [{
                            label: 'Doanh thu (‚Ç´)',
                            data: data.map(d => d.revenue),
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#10b981',
                            pointRadius: 5,
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString('vi-VN') + '‚Ç´';
                                    }
                                }
                            }
                        }
                    }
                });
            });

        // CATEGORY CHART
        const ctx2 = document.getElementById('foodChart').getContext('2d');
        const categoryNames = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.CategoryNames));
        const foodCounts = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.FoodCounts));

        const colors = [
            '#4f46e5', '#06b6d4', '#10b981', '#f59e0b', '#ef4444', 
            '#8b5cf6', '#ec4899', '#6366f1', '#14b8a6', '#84cc16'
        ];

        new Chart(ctx2, {
            type: 'doughnut',
            data: {
                labels: categoryNames,
                datasets: [{
                    data: foodCounts,
                    backgroundColor: colors,
                    borderWidth: 0,
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '65%',
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            usePointStyle: true,
                            padding: 15,
                            font: { size: 11 }
                        }
                    }
                }
            }
        });
    </script>
}