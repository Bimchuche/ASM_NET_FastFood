@model IEnumerable<ASM1_NET.Models.Order>

@{
    ViewData["Title"] = "Quáº£n lÃ½ Ä‘Æ¡n hÃ ng";
    var pendingCount = Model.Count(o => o.Status == "Pending");
    var deliveringCount = Model.Count(o => o.Status == "Delivering");
    var completedCount = Model.Count(o => o.Status == "Completed");
    var totalRevenue = Model.Where(o => o.Status == "Completed").Sum(o => o.TotalAmount);
}

<!-- ALERTS -->
@if (TempData["Success"] != null)
{
    <div class="admin-alert success">âœ… @TempData["Success"]</div>
}
@if (TempData["Error"] != null)
{
    <div class="admin-alert danger">âŒ @TempData["Error"]</div>
}

<!-- STATS -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon warning">â³</div>
        <div class="stat-info">
            <h3>@pendingCount</h3>
            <p>ÄÆ¡n chá» xá»­ lÃ½</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon primary">ğŸšš</div>
        <div class="stat-info">
            <h3>@deliveringCount</h3>
            <p>Äang giao</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon success">âœ…</div>
        <div class="stat-info">
            <h3>@completedCount</h3>
            <p>HoÃ n thÃ nh</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon danger">ğŸ’°</div>
        <div class="stat-info">
            <h3>@totalRevenue.ToString("N0") â‚«</h3>
            <p>Doanh thu</p>
        </div>
    </div>
</div>

<!-- HEADER -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="mb-1">ğŸ“¦ Quáº£n lÃ½ Ä‘Æ¡n hÃ ng</h2>
        <p class="text-muted mb-0">Tá»•ng: <strong>@Model.Count()</strong> Ä‘Æ¡n</p>
    </div>
</div>

<!-- TABLE CARD -->
<div class="admin-table-card">
    <div class="table-header">
        <h3>ğŸ“‹ Danh sÃ¡ch Ä‘Æ¡n hÃ ng</h3>
        <div class="table-search">
            <select id="filterStatus" onchange="filterByStatus()" class="form-select form-select-sm" style="width: auto;">
                <option value="">Táº¥t cáº£ tráº¡ng thÃ¡i</option>
                <option value="Pending">â³ Chá» xá»­ lÃ½</option>
                <option value="Delivering">ğŸšš Äang giao</option>
                <option value="Completed">âœ… HoÃ n thÃ nh</option>
                <option value="Cancelled">âŒ ÄÃ£ há»§y</option>
            </select>
            <input type="text" id="searchOrder" placeholder="TÃ¬m kiáº¿m..." onkeyup="filterTable()" />
        </div>
    </div>
    
    <table class="admin-table" id="orderTable">
        <thead>
            <tr>
                <th>MÃ£ Ä‘Æ¡n</th>
                <th>KhÃ¡ch hÃ ng</th>
                <th>NgÃ y Ä‘áº·t</th>
                <th>Tá»•ng tiá»n</th>
                <th>Tráº¡ng thÃ¡i</th>
                <th>Shipper</th>
                <th style="width: 180px;">HÃ nh Ä‘á»™ng</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var o in Model.OrderByDescending(o => o.OrderDate))
            {
                var statusClass = o.Status switch
                {
                    "Pending" => "warning",
                    "Delivering" => "info",
                    "Completed" => "success",
                    "Cancelled" => "danger",
                    _ => "info"
                };
                var statusIcon = o.Status switch
                {
                    "Pending" => "â³",
                    "Delivering" => "ğŸšš",
                    "Completed" => "âœ…",
                    "Cancelled" => "âŒ",
                    _ => "ğŸ“¦"
                };
                var statusText = o.Status switch
                {
                    "Pending" => "Chá» xá»­ lÃ½",
                    "Delivering" => "Äang giao",
                    "Completed" => "HoÃ n thÃ nh",
                    "Cancelled" => "ÄÃ£ há»§y",
                    _ => o.Status
                };
                
                <tr data-status="@o.Status">
                    <td>
                        <strong class="text-primary">#@o.OrderCode</strong>
                    </td>
                    <td>
                        <strong>@(o.Customer?.FullName ?? "N/A")</strong>
                        <br /><small class="text-muted">ğŸ“ @o.Phone</small>
                    </td>
                    <td>
                        <span>@o.OrderDate.ToString("dd/MM/yyyy")</span>
                        <br /><small class="text-muted">@o.OrderDate.ToString("HH:mm")</small>
                    </td>
                    <td>
                        <strong class="text-success">@o.TotalAmount.ToString("N0") â‚«</strong>
                    </td>
                    <td>
                        <span class="badge-admin @statusClass">@statusIcon @statusText</span>
                    </td>
                    <td>
                        @if (o.Shipper != null)
                        {
                            <span class="badge-admin info">ğŸš´ @o.Shipper.FullName</span>
                        }
                        else
                        {
                            <span class="text-muted">ChÆ°a cÃ³</span>
                        }
                    </td>
                    <td>
                        <div class="action-btns">
                            <a asp-action="Detail" asp-route-id="@o.Id" class="action-btn view" title="Xem chi tiáº¿t">
                                ğŸ‘ï¸
                            </a>
                            <a asp-action="Edit" asp-route-id="@o.Id" class="action-btn edit" title="Sá»­a">
                                âœï¸
                            </a>
                            <a asp-action="Delete" asp-route-id="@o.Id" class="action-btn delete" title="XÃ³a"
                               onclick="return confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a Ä‘Æ¡n hÃ ng nÃ y?')">
                                ğŸ—‘ï¸
                            </a>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts {
<script>
function filterTable() {
    var input = document.getElementById("searchOrder");
    var filter = input.value.toLowerCase();
    var table = document.getElementById("orderTable");
    var rows = table.getElementsByTagName("tr");
    
    for (var i = 1; i < rows.length; i++) {
        var cells = rows[i].getElementsByTagName("td");
        var found = false;
        for (var j = 0; j < cells.length; j++) {
            if (cells[j].textContent.toLowerCase().indexOf(filter) > -1) {
                found = true;
                break;
            }
        }
        rows[i].style.display = found ? "" : "none";
    }
}

function filterByStatus() {
    var status = document.getElementById("filterStatus").value;
    var table = document.getElementById("orderTable");
    var rows = table.querySelectorAll("tbody tr");
    
    rows.forEach(function(row) {
        if (status === "" || row.dataset.status === status) {
            row.style.display = "";
        } else {
            row.style.display = "none";
        }
    });
}
</script>
}