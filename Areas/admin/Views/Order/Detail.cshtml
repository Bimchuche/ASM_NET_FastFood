@model ASM1_NET.Models.Order
@{
    ViewData["Title"] = "Chi ti·∫øt ƒë∆°n h√†ng";
    var statusClass = Model.Status switch {
        "Pending" => "status-pending",
        "Confirmed" => "status-confirmed",
        "Delivering" => "status-delivering",
        "Completed" => "status-completed",
        "Cancelled" => "status-cancelled",
        _ => "status-default"
    };
    var statusIcon = Model.Status switch {
        "Pending" => "‚è≥",
        "Confirmed" => "‚úÖ",
        "Delivering" => "üöö",
        "Completed" => "üéâ",
        "Cancelled" => "‚ùå",
        _ => "üì¶"
    };
    var statusText = Model.Status switch {
        "Pending" => "Ch·ªù x√°c nh·∫≠n",
        "Confirmed" => "ƒê√£ x√°c nh·∫≠n",
        "Delivering" => "ƒêang giao",
        "Completed" => "Ho√†n th√†nh",
        "Cancelled" => "ƒê√£ h·ªßy",
        _ => Model.Status
    };
}

<link rel="stylesheet" href="~/admin/css/order-detail.css" />

<div class="order-detail-page">
    <!-- Header -->
    <div class="detail-header">
        <div class="header-content">
            <div class="header-left">
                <a asp-action="Index" class="btn-back">
                    <span>‚Üê</span>
                </a>
                <div class="header-info">
                    <span class="order-badge">#@Model.OrderCode</span>
                    <h1>Chi ti·∫øt ƒë∆°n h√†ng</h1>
                    <div class="order-meta">
                        <span>üìÖ @Model.OrderDate.ToString("dd/MM/yyyy HH:mm")</span>
                        <span class="status-badge @statusClass">@statusIcon @statusText</span>
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <a asp-action="Index" class="btn-secondary">
                    ‚¨ÖÔ∏è Danh s√°ch ƒë∆°n h√†ng
                </a>
            </div>
        </div>
    </div>

    <div class="detail-content">
        <!-- Left Column -->
        <div class="detail-left">
            <!-- Customer Info Card -->
            <div class="info-card customer-card">
                <div class="card-header">
                    <span class="card-icon">üë§</span>
                    <h3>Th√¥ng tin kh√°ch h√†ng</h3>
                </div>
                <div class="card-body">
                    <div class="info-row">
                        <div class="info-item">
                            <span class="info-label">H·ªç t√™n</span>
                            <span class="info-value">@Model.Customer?.FullName</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Email</span>
                            <span class="info-value">@Model.Customer?.Email</span>
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="info-item">
                            <span class="info-label">üìû S·ªë ƒëi·ªán tho·∫°i</span>
                            <a href="tel:@Model.Phone" class="info-value phone-link">@Model.Phone</a>
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="info-item full">
                            <span class="info-label">üìç ƒê·ªãa ch·ªâ giao h√†ng</span>
                            <span class="info-value address">@Model.Address</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Shipper Info Card -->
            <div class="info-card shipper-card">
                <div class="card-header">
                    <span class="card-icon">üöö</span>
                    <h3>Th√¥ng tin giao h√†ng</h3>
                </div>
                <div class="card-body">
                    @if (Model.Shipper != null)
                    {
                        <div class="shipper-info">
                            <div class="shipper-avatar">
                                @Model.Shipper.FullName?.Substring(0, 1).ToUpper()
                            </div>
                            <div class="shipper-details">
                                <span class="shipper-name">@Model.Shipper.FullName</span>
                                <span class="shipper-phone">üìû @Model.Shipper.Phone</span>
                            </div>
                        </div>
                        @if (Model.DeliveryDate.HasValue)
                        {
                            <div class="delivery-time">
                                <span class="label">‚è∞ Th·ªùi gian giao:</span>
                                <span class="value">@Model.DeliveryDate.Value.ToString("dd/MM/yyyy HH:mm")</span>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="no-shipper">
                            <span class="icon">üîç</span>
                            <span>Ch∆∞a ph√¢n c√¥ng shipper</span>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Right Column -->
        <div class="detail-right">
            <!-- Order Items Card -->
            <div class="info-card items-card">
                <div class="card-header">
                    <span class="card-icon">üõí</span>
                    <h3>Danh s√°ch s·∫£n ph·∫©m</h3>
                    <span class="item-count">@Model.OrderDetails?.Count() m√≥n</span>
                </div>
                <div class="card-body">
                    <div class="items-table">
                        <div class="table-header">
                            <span class="col-item">S·∫£n ph·∫©m</span>
                            <span class="col-price">ƒê∆°n gi√°</span>
                            <span class="col-qty">SL</span>
                            <span class="col-total">Th√†nh ti·ªÅn</span>
                        </div>
                        @if (Model.OrderDetails != null)
                        {
                            @foreach (var d in Model.OrderDetails)
                            {
                                var itemName = d.Food?.Name ?? d.Combo?.Name ?? "S·∫£n ph·∫©m";
                                var itemImage = d.Food?.ImageUrl ?? d.Combo?.ImageUrl ?? "/images/no-image.png";
                                var lineTotal = d.UnitPrice * d.Quantity;
                                
                                <div class="table-row">
                                    <div class="col-item">
                                        <img src="@itemImage" alt="@itemName" onerror="this.src='/images/no-image.png'" />
                                        <span class="item-name">@itemName</span>
                                    </div>
                                    <span class="col-price">@d.UnitPrice.ToString("N0")ƒë</span>
                                    <span class="col-qty">x@d.Quantity</span>
                                    <span class="col-total">@lineTotal.ToString("N0")ƒë</span>
                                </div>
                            }
                        }
                    </div>
                </div>
            </div>

            <!-- Payment Summary Card -->
            <div class="info-card payment-card">
                <div class="card-header">
                    <span class="card-icon">üí∞</span>
                    <h3>T·ªïng thanh to√°n</h3>
                </div>
                <div class="card-body">
                    <div class="payment-row">
                        <span>T·∫°m t√≠nh</span>
                        <span>@((Model.TotalAmount + Model.DiscountAmount).ToString("N0"))ƒë</span>
                    </div>
                    @if (Model.DiscountAmount > 0)
                    {
                        <div class="payment-row discount">
                            <span>üéÅ Gi·∫£m gi√°</span>
                            <span>-@Model.DiscountAmount.ToString("N0")ƒë</span>
                        </div>
                    }
                    <div class="payment-total">
                        <span>T·ªïng c·ªông</span>
                        <span class="total-amount">@Model.TotalAmount.ToString("N0")ƒë</span>
                    </div>
                    <div class="payment-method">
                        @if (Model.PaymentMethod == "COD")
                        {
                            <span class="method-badge cod">üíµ Thanh to√°n khi nh·∫≠n h√†ng (COD)</span>
                        }
                        else
                        {
                            <span class="method-badge qr">üí≥ Thanh to√°n online (QR)</span>
                            @if (!string.IsNullOrEmpty(Model.PaymentStatus))
                            {
                                <span class="payment-status @(Model.PaymentStatus == "Paid" ? "paid" : "")">
                                    @(Model.PaymentStatus == "Paid" ? "‚úÖ ƒê√£ thanh to√°n" : "‚è≥ Ch·ªù thanh to√°n")
                                </span>
                            }
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delivery Proof -->
    @if (!string.IsNullOrEmpty(Model.DeliveryProofImageUrl))
    {
        <div class="info-card proof-card">
            <div class="card-header">
                <span class="card-icon">üì∏</span>
                <h3>·∫¢nh x√°c nh·∫≠n giao h√†ng</h3>
            </div>
            <div class="card-body">
                <div class="proof-image-wrapper">
                    <img src="@Model.DeliveryProofImageUrl" alt="·∫¢nh x√°c nh·∫≠n" onclick="window.open(this.src, '_blank')" />
                    <span class="view-hint">Click ƒë·ªÉ xem ·∫£nh l·ªõn</span>
                </div>
            </div>
        </div>
    }
</div>