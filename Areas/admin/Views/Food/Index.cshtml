@model IEnumerable<ASM1_NET.Models.Food>

@{
    ViewData["Title"] = "Qu·∫£n l√Ω m√≥n ƒÉn";
    var categories = Model.Where(f => f.Category != null).Select(f => f.Category!).DistinctBy(c => c.Id).OrderBy(c => c.Name).ToList();
}

<!-- ALERTS -->
@if (TempData["Success"] != null)
{
    <div class="admin-alert success">‚úÖ @TempData["Success"]</div>
}
@if (TempData["Error"] != null)
{
    <div class="admin-alert danger">‚ö†Ô∏è @TempData["Error"]</div>
}

<!-- Hidden form for bulk delete -->
<form id="bulkDeleteForm" asp-action="BulkDelete" method="post" style="display:none;">
    @Html.AntiForgeryToken()
    <div id="deleteIds"></div>
</form>

<!-- HEADER -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="mb-1">üçï Qu·∫£n l√Ω m√≥n ƒÉn</h2>
        <p class="text-muted mb-0">T·ªïng: <strong>@Model.Count()</strong> m√≥n</p>
    </div>
    <div class="d-flex gap-2">
        <button type="button" class="btn-admin danger" onclick="submitBulkDelete()">
            üóëÔ∏è X√≥a ƒë√£ ch·ªçn (<span id="selectedCount">0</span>)
        </button>
        <a asp-action="Create" class="btn-admin primary">
            <span>‚ûï</span> Th√™m m√≥n m·ªõi
        </a>
    </div>
</div>

<!-- TABLE CARD -->
<div class="admin-table-card">
    <div class="table-header">
        <h3>üìã Danh s√°ch m√≥n ƒÉn</h3>
        <div class="table-search">
            <select id="filterCategory" onchange="filterByCategory()" class="form-select form-select-sm" style="width: auto; min-width: 150px;">
                <option value="">T·∫•t c·∫£ danh m·ª•c</option>
                @foreach (var cat in categories)
                {
                    <option value="@cat.Name">@cat.Name</option>
                }
            </select>
            <input type="text" id="searchFood" placeholder="T√¨m ki·∫øm..." onkeyup="filterTable()" />
        </div>
    </div>
    
    <table class="admin-table" id="foodTable">
        <thead>
            <tr>
                <th style="width: 40px;"><input type="checkbox" id="selectAll" onclick="toggleAll(this)"></th>
                <th style="width: 80px;">·∫¢nh</th>
                <th>T√™n m√≥n</th>
                <th>Danh m·ª•c</th>
                <th>Gi√°</th>
                <th>Tr·∫°ng th√°i</th>
                <th style="width: 150px;">H√†nh ƒë·ªông</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var f in Model)
            {
                <tr data-category="@(f.Category?.Name ?? "")">
                    <td><input type="checkbox" class="item-checkbox" data-id="@f.Id" onclick="updateCount()"></td>
                    <td>
                        @if (!string.IsNullOrEmpty(f.ImageUrl))
                        {
                            <img src="@f.ImageUrl" alt="@f.Name" />
                        }
                        else
                        {
                            <div class="stat-icon primary" style="width: 50px; height: 50px; font-size: 1.2rem;">üçΩÔ∏è</div>
                        }
                    </td>
                    <td>
                        <strong>@f.Name</strong>
                        @if (!string.IsNullOrEmpty(f.Description))
                        {
                            <br /><small class="text-muted">@(f.Description.Length > 50 ? f.Description.Substring(0, 50) + "..." : f.Description)</small>
                        }
                    </td>
                    <td>
                        <span class="badge-admin info">@(f.Category?.Name ?? "Ch∆∞a ph√¢n lo·∫°i")</span>
                    </td>
                    <td>
                        <strong class="text-primary">@f.Price.ToString("N0") ‚Ç´</strong>
                    </td>
                    <td>
                        @if (f.IsAvailable)
                        {
                            <span class="badge-admin success">‚úì ƒêang b√°n</span>
                        }
                        else
                        {
                            <span class="badge-admin danger">‚úï Ng·ª´ng b√°n</span>
                        }
                    </td>
                    <td>
                        <div class="action-btns">
                            <a asp-action="Edit" asp-route-id="@f.Id" class="action-btn edit" title="S·ª≠a">
                                ‚úèÔ∏è
                            </a>
                            <a asp-action="Delete" asp-route-id="@f.Id" class="action-btn delete" title="X√≥a"
                               onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a m√≥n ƒÉn n√†y?')">
                                üóëÔ∏è
                            </a>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@section Scripts {
<script src="~/admin/js/admin-table.js"></script>
<script>
function filterTable() { 
    filterByCategory('filterCategory', 'searchFood', 'foodTable'); 
}
function filterByCategory() {
    filterTable();
}
function submitBulkDelete() {
    window.submitBulkDelete('m√≥n ƒÉn');
}
</script>
}