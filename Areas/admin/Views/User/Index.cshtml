@model IEnumerable<ASM1_NET.Models.User>
@{
    ViewData["Title"] = "Qu·∫£n l√Ω ng∆∞·ªùi d√πng";
    var adminCount = Model.Count(u => u.Role == "Admin");
    var shipperCount = Model.Count(u => u.Role == "Shipper");
    var customerCount = Model.Count(u => u.Role == "Customer");
}

<!-- ALERTS -->
@if (TempData["Success"] != null)
{
    <div class="admin-alert success">‚úÖ @TempData["Success"]</div>
}
@if (TempData["Error"] != null)
{
    <div class="admin-alert danger">‚ö†Ô∏è @TempData["Error"]</div>
}

<!-- Hidden form for bulk delete -->
<form id="bulkDeleteForm" asp-action="BulkDelete" method="post" style="display:none;">
    @Html.AntiForgeryToken()
    <div id="deleteIds"></div>
</form>

<!-- Page Header -->
<div class="admin-page-header">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
        <div>
            <h2 class="admin-page-title">üë• Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h2>
            <p class="admin-page-subtitle">Qu·∫£n l√Ω t√†i kho·∫£n ng∆∞·ªùi d√πng h·ªá th·ªëng</p>
        </div>
        <div class="d-flex gap-2">
            <button type="button" class="btn btn-admin btn-admin-delete" onclick="submitBulkDelete()">
                üóëÔ∏è X√≥a ƒë√£ ch·ªçn (<span id="selectedCount">0</span>)
            </button>
            <a asp-action="Create" class="btn btn-admin btn-admin-add">
                ‚ûï Th√™m ng∆∞·ªùi d√πng
            </a>
        </div>
    </div>
</div>

<!-- Stats Cards -->
<div class="admin-stats-row">
    <div class="admin-stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #10b981, #059669);">üë•</div>
        <div class="stat-info">
            <span class="stat-value">@Model.Count()</span>
            <span class="stat-label">T·ªïng ng∆∞·ªùi d√πng</span>
        </div>
    </div>
    <div class="admin-stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #ef4444, #dc2626);">üëë</div>
        <div class="stat-info">
            <span class="stat-value">@adminCount</span>
            <span class="stat-label">Admin</span>
        </div>
    </div>
    <div class="admin-stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);">üöö</div>
        <div class="stat-info">
            <span class="stat-value">@shipperCount</span>
            <span class="stat-label">Shipper</span>
        </div>
    </div>
    <div class="admin-stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">üõí</div>
        <div class="stat-info">
            <span class="stat-value">@customerCount</span>
            <span class="stat-label">Kh√°ch h√†ng</span>
        </div>
    </div>
</div>

<!-- Filter Bar -->
<div class="admin-filter-bar">
    <div class="search-box">
        <span class="search-icon">üîç</span>
        <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm ng∆∞·ªùi d√πng..." onkeyup="filterTable()" />
    </div>
    <div class="filter-group">
        <select id="roleFilter" class="form-select" onchange="filterTable()">
            <option value="">T·∫•t c·∫£ vai tr√≤</option>
            <option value="Admin">Admin</option>
            <option value="Shipper">Shipper</option>
            <option value="Customer">Customer</option>
        </select>
    </div>
</div>

<!-- Data Table -->
<div class="admin-table-card">
    <table class="admin-table" id="userTable">
        <thead>
            <tr>
                <th width="40"><input type="checkbox" id="selectAll" onclick="toggleAll(this)"></th>
                <th width="50">ID</th>
                <th>H·ªç t√™n</th>
                <th>Email</th>
                <th>SƒêT</th>
                <th width="100">Vai tr√≤</th>
                <th width="100">Tr·∫°ng th√°i</th>
                <th width="180">H√†nh ƒë·ªông</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var u in Model)
            {
                var roleClass = u.Role switch
                {
                    "Admin" => "role-admin",
                    "Shipper" => "role-shipper",
                    _ => "role-customer"
                };
                var roleIcon = u.Role switch
                {
                    "Admin" => "üëë",
                    "Shipper" => "üöö",
                    _ => "üõí"
                };
                
                <tr data-role="@u.Role">
                    <td><input type="checkbox" class="item-checkbox" data-id="@u.Id" onclick="updateCount()"></td>
                    <td>
                        <span class="id-badge">#@u.Id</span>
                    </td>
                    <td>
                        <div class="user-info">
                            @if (!string.IsNullOrEmpty(u.AvatarUrl))
                            {
                                <img src="@u.AvatarUrl" alt="@u.FullName" class="user-avatar-img" 
                                     style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;" />
                            }
                            else
                            {
                                <div class="user-avatar">@(u.FullName?.Substring(0, 1).ToUpper() ?? "U")</div>
                            }
                            <strong>@u.FullName</strong>
                        </div>
                    </td>
                    <td>
                        <span class="text-muted">üìß @u.Email</span>
                    </td>
                    <td>
                        <span class="text-muted">üìû @(u.Phone ?? "‚Äî")</span>
                    </td>
                    <td>
                        <span class="role-badge @roleClass">@roleIcon @u.Role</span>
                    </td>
                    <td>
                        @if (u.IsActive)
                        {
                            <span class="status-badge status-active">‚úÖ Ho·∫°t ƒë·ªông</span>
                        }
                        else
                        {
                            <span class="status-badge status-inactive">üîí B·ªã kh√≥a</span>
                        }
                    </td>
                    <td>
                        <div class="action-buttons">
                            <a asp-action="Edit" asp-route-id="@u.Id" class="btn-action btn-edit" title="S·ª≠a">
                                ‚úèÔ∏è
                            </a>
                            <a asp-action="ToggleActive" asp-route-id="@u.Id" 
                               class="btn-action @(u.IsActive ? "btn-warning" : "btn-success")" 
                               title="@(u.IsActive ? "Kh√≥a" : "M·ªü kh√≥a")">
                                @(u.IsActive ? "üîí" : "üîì")
                            </a>
                            <form asp-action="Delete" asp-route-id="@u.Id" method="post" style="display:inline"
                                  onsubmit="return confirm('B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a ng∆∞·ªùi d√πng n√†y?');">
                                <button type="submit" class="btn-action btn-delete" title="X√≥a">
                                    üóëÔ∏è
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
    
    @if (!Model.Any())
    {
        <div class="empty-state">
            <div class="empty-icon">üë•</div>
            <h4>Ch∆∞a c√≥ ng∆∞·ªùi d√πng n√†o</h4>
            <p>H√£y th√™m ng∆∞·ªùi d√πng ƒë·∫ßu ti√™n</p>
        </div>
    }
</div>

<script src="~/admin/js/admin-table.js"></script>
<script>
function filterTable() {
    const searchInput = document.getElementById('searchInput').value.toLowerCase();
    const roleFilter = document.getElementById('roleFilter').value;
    const rows = document.querySelectorAll('#userTable tbody tr');
    
    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        const role = row.dataset.role;
        const matchSearch = text.includes(searchInput);
        const matchRole = !roleFilter || role === roleFilter;
        row.style.display = (matchSearch && matchRole) ? '' : 'none';
    });
}
function submitBulkDelete() {
    window.submitBulkDelete('ng∆∞·ªùi d√πng');
}
</script>