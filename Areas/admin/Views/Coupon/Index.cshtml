@model IEnumerable<ASM1_NET.Models.Coupon>
@{
    ViewData["Title"] = "Qu·∫£n l√Ω m√£ gi·∫£m gi√°";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<link rel="stylesheet" href="~/admin/css/admin-theme.css" />

<!-- PAGE HEADER -->
<div class="admin-page-header">
    <div>
        <h1>üéüÔ∏è Qu·∫£n l√Ω m√£ gi·∫£m gi√°</h1>
        <p>T·∫°o v√† qu·∫£n l√Ω m√£ khuy·∫øn m√£i cho kh√°ch h√†ng</p>
    </div>
    <a asp-action="Create" class="btn-admin primary">
        ‚ûï Th√™m m√£ gi·∫£m gi√°
    </a>
</div>

<!-- STATS -->
<div class="stats-grid" style="margin-bottom: 30px;">
    <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #667eea, #764ba2);">üéüÔ∏è</div>
        <div class="stat-info">
            <h3>@Model.Count()</h3>
            <p>T·ªïng m√£</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #10b981, #059669);">‚úÖ</div>
        <div class="stat-info">
            <h3>@Model.Count(c => c.IsActive)</h3>
            <p>ƒêang ho·∫°t ƒë·ªông</p>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">üìä</div>
        <div class="stat-info">
            <h3>@Model.Sum(c => c.UsedCount)</h3>
            <p>L∆∞·ª£t s·ª≠ d·ª•ng</p>
        </div>
    </div>
</div>

<!-- MESSAGES -->
@if (TempData["Success"] != null)
{
    <div class="alert-admin success">‚úÖ @TempData["Success"]</div>
}
@if (TempData["Error"] != null)
{
    <div class="alert-admin danger">‚ö†Ô∏è @TempData["Error"]</div>
}

<!-- TABLE -->
<div class="admin-table-card">
    <div class="table-header">
        <h3>üìã Danh s√°ch m√£ gi·∫£m gi√°</h3>
    </div>
    
    <table class="admin-table">
        <thead>
            <tr>
                <th>M√£</th>
                <th>Gi·∫£m gi√°</th>
                <th>ƒê∆°n t·ªëi thi·ªÉu</th>
                <th>Gi·∫£m t·ªëi ƒëa</th>
                <th>H·∫°n s·ª≠ d·ª•ng</th>
                <th>L∆∞·ª£t d√πng</th>
                <th>Tr·∫°ng th√°i</th>
                <th style="width: 180px;">H√†nh ƒë·ªông</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var coupon in Model)
            {
                var isExpired = coupon.ExpiryDate.HasValue && coupon.ExpiryDate < DateTime.Now;
                var isLimitReached = coupon.UsageLimit > 0 && coupon.UsedCount >= coupon.UsageLimit;
                
                <tr>
                    <td>
                        <strong class="text-primary" style="font-family: monospace; font-size: 1.1rem;">
                            @coupon.Code
                        </strong>
                    </td>
                    <td>
                        <span class="badge-admin success">@coupon.DiscountPercent%</span>
                    </td>
                    <td>
                        @if (coupon.MinOrderAmount.HasValue)
                        {
                            <span>@coupon.MinOrderAmount.Value.ToString("N0")‚Ç´</span>
                        }
                        else
                        {
                            <span class="text-muted">Kh√¥ng</span>
                        }
                    </td>
                    <td>
                        @if (coupon.MaxDiscountAmount.HasValue)
                        {
                            <span>@coupon.MaxDiscountAmount.Value.ToString("N0")‚Ç´</span>
                        }
                        else
                        {
                            <span class="text-muted">Kh√¥ng gi·ªõi h·∫°n</span>
                        }
                    </td>
                    <td>
                        @if (coupon.ExpiryDate.HasValue)
                        {
                            <span class="@(isExpired ? "text-danger" : "")">
                                @coupon.ExpiryDate.Value.ToString("dd/MM/yyyy")
                                @if (isExpired)
                                {
                                    <br /><small>‚ö†Ô∏è ƒê√£ h·∫øt h·∫°n</small>
                                }
                            </span>
                        }
                        else
                        {
                            <span class="text-muted">Kh√¥ng gi·ªõi h·∫°n</span>
                        }
                    </td>
                    <td>
                        <span>@coupon.UsedCount</span>
                        @if (coupon.UsageLimit > 0)
                        {
                            <span class="text-muted">/ @coupon.UsageLimit</span>
                        }
                    </td>
                    <td>
                        @if (!coupon.IsActive)
                        {
                            <span class="badge-admin danger">‚ùå T·∫°m t·∫Øt</span>
                        }
                        else if (isExpired)
                        {
                            <span class="badge-admin warning">‚è∞ H·∫øt h·∫°n</span>
                        }
                        else if (isLimitReached)
                        {
                            <span class="badge-admin warning">üìä H·∫øt l∆∞·ª£t</span>
                        }
                        else
                        {
                            <span class="badge-admin success">‚úÖ Ho·∫°t ƒë·ªông</span>
                        }
                    </td>
                    <td>
                        <div style="display: flex; gap: 8px;">
                            <a asp-action="Edit" asp-route-id="@coupon.Id" class="action-btn" 
                               style="background: linear-gradient(135deg, #667eea, #764ba2);" title="S·ª≠a">
                                ‚úèÔ∏è
                            </a>
                            <form asp-action="ToggleActive" method="post" style="display: inline;">
                                <input type="hidden" name="id" value="@coupon.Id" />
                                <button type="submit" class="action-btn" 
                                        style="background: linear-gradient(135deg, @(coupon.IsActive ? "#f59e0b" : "#10b981"), @(coupon.IsActive ? "#d97706" : "#059669"));"
                                        title="@(coupon.IsActive ? "T·∫Øt" : "B·∫≠t")">
                                    @(coupon.IsActive ? "‚è∏Ô∏è" : "‚ñ∂Ô∏è")
                                </button>
                            </form>
                            <form asp-action="Delete" method="post" style="display: inline;"
                                  onsubmit="return confirm('X√≥a m√£ gi·∫£m gi√° @coupon.Code?');">
                                <input type="hidden" name="id" value="@coupon.Id" />
                                <button type="submit" class="action-btn" 
                                        style="background: linear-gradient(135deg, #ef4444, #dc2626);" title="X√≥a">
                                    üóëÔ∏è
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
            }
            @if (!Model.Any())
            {
                <tr>
                    <td colspan="8" class="text-center text-muted" style="padding: 40px;">
                        üéüÔ∏è Ch∆∞a c√≥ m√£ gi·∫£m gi√° n√†o. <a asp-action="Create">T·∫°o ngay!</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
