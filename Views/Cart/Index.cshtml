@model ASM1_NET.Models.Cart
@{
    ViewData["Title"] = "Gi·ªè h√†ng";
    var totalAmount = Model?.CartItems?.Sum(i => i.Price * i.Quantity) ?? 0;
    var totalItems = Model?.CartItems?.Sum(i => i.Quantity) ?? 0;
}

<link rel="stylesheet" href="~/client/css/cart.css" />

<div class="cart-page">
    <div class="container">
        <!-- HERO -->
        <div class="cart-hero">
            <h1>üõí Gi·ªè h√†ng c·ªßa b·∫°n</h1>
            <p>Ki·ªÉm tra v√† thanh to√°n ƒë∆°n h√†ng</p>
            
            @if (Model?.CartItems?.Any() == true)
            {
                <div class="cart-stats">
                    <div class="cart-stat">
                        <div class="value">@totalItems</div>
                        <div class="label">S·∫£n ph·∫©m</div>
                    </div>
                    <div class="cart-stat">
                        <div class="value">@totalAmount.ToString("N0")‚Ç´</div>
                        <div class="label">T·ªïng ti·ªÅn</div>
                    </div>
                </div>
            }
        </div>
        
        @if (Model == null || Model.CartItems == null || !Model.CartItems.Any())
        {
            <div class="cart-card">
                <div class="cart-empty">
                    <div class="icon">üõí</div>
                    <h3>Gi·ªè h√†ng tr·ªëng</h3>
                    <p>H√£y th√™m m√≥n ƒÉn y√™u th√≠ch v√†o gi·ªè h√†ng!</p>
                    <a href="/Food" class="btn-cart-checkout" style="display: inline-block; padding: 15px 40px;">
                        üçï Xem Menu
                    </a>
                </div>
            </div>
        }
        else
        {
            <div class="cart-card">
                <div class="cart-card-header">
                    <h3>üìã Chi ti·∫øt gi·ªè h√†ng</h3>
                </div>
                <div class="cart-card-body">
                    @foreach (var item in Model.CartItems)
                    {
                        var itemName = item.Food?.Name ?? item.Combo?.Name ?? "S·∫£n ph·∫©m";
                        var itemImage = item.Food?.ImageUrl ?? item.Combo?.ImageUrl ?? "";
                        var isCombo = item.ComboId.HasValue;
                        var subtotal = item.Price * item.Quantity;
                        
                        <div class="cart-item">
                            <div class="cart-item-image">
                                @if (!string.IsNullOrEmpty(itemImage))
                                {
                                    <img src="@itemImage" alt="@itemName" onerror="this.parentElement.innerHTML='üçî'" />
                                }
                                else
                                {
                                    <span>@(isCombo ? "üéÅ" : "üçî")</span>
                                }
                            </div>
                            
                            <div class="cart-item-info">
                                <span class="cart-item-name">@itemName</span>
                                <span class="cart-item-type @(isCombo ? "combo" : "food")">
                                    @(isCombo ? "üéÅ COMBO" : "üçî M√ìN ƒÇN")
                                </span>
                            </div>
                            
                            <div class="cart-item-qty">
                                @if (item.FoodId != null)
                                {
                                    <button class="qty-btn" onclick="foodDecrease(@item.FoodId)">‚àí</button>
                                    <span class="qty-value">@item.Quantity</span>
                                    <button class="qty-btn" onclick="foodIncrease(@item.FoodId)">+</button>
                                }
                                else
                                {
                                    <button class="qty-btn" onclick="comboDecrease(@item.ComboId)">‚àí</button>
                                    <span class="qty-value">@item.Quantity</span>
                                    <button class="qty-btn" onclick="comboIncrease(@item.ComboId)">+</button>
                                }
                            </div>
                            
                            <div class="cart-item-price">
                                <span class="unit">@item.Price.ToString("N0")‚Ç´ √ó @item.Quantity</span>
                                <span class="total">@subtotal.ToString("N0")‚Ç´</span>
                            </div>
                            
                            @if (item.FoodId != null)
                            {
                                <button class="cart-item-remove" onclick="foodRemove(@item.FoodId)">üóëÔ∏è</button>
                            }
                            else
                            {
                                <button class="cart-item-remove" onclick="comboRemove(@item.ComboId)">üóëÔ∏è</button>
                            }
                        </div>
                    }
                </div>
                
                <div class="cart-footer">
                    <div class="cart-total-row">
                        <span class="cart-total-label">T·ªïng c·ªông:</span>
                        <span class="cart-total-value">@totalAmount.ToString("N0")‚Ç´</span>
                    </div>
                    <div class="cart-actions">
                        <a href="/Food" class="btn-cart-continue">‚¨ÖÔ∏è Ti·∫øp t·ª•c mua</a>
                        <a href="/Order/Checkout" class="btn-cart-checkout">‚úÖ Thanh to√°n ngay</a>
                    </div>
                </div>
            </div>
        }
    </div>
</div>