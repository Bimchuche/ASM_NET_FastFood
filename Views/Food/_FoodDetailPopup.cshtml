@model ASM1_NET.Models.Food

@{
    var avgRating = Model.Reviews?.Any() == true ? Model.Reviews.Average(r => r.Rating) : 0;
    var reviewCount = Model.Reviews?.Count ?? 0;
}

<div style="display: flex; flex-direction: column; width: 100%; max-height: 80vh; overflow: hidden;">
    <img src="@Model.ImageUrl" alt="@Model.Name" 
         style="width: 100%; height: auto; max-height: 200px; object-fit: contain; display: block; background: #0d0d15;"
         onerror="this.src='/images/no-image.png'" />
    
    <div style="padding: 20px; background: #1a1a2e; overflow-y: auto; flex: 1;">
        @if (Model.Category != null)
        {
            <span style="display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; margin-bottom: 10px; background: rgba(16, 185, 129, 0.2); color: #10b981;">
                üçΩÔ∏è @Model.Category.Name
            </span>
        }
        
        <h3 style="font-size: 1.3rem; font-weight: 700; color: #fff; margin: 0 0 10px;">@Model.Name</h3>
        
        <!-- Rating Display -->
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
            <span style="color: #fbbf24; font-size: 1rem;">
                @for (int i = 1; i <= 5; i++)
                {
                    @(i <= Math.Round(avgRating) ? "‚òÖ" : "‚òÜ")
                }
            </span>
            <span style="color: #f59e0b; font-weight: 600;">@avgRating.ToString("0.0")</span>
            <span style="color: #9ca3af; font-size: 0.85rem;">(@reviewCount ƒë√°nh gi√°)</span>
        </div>
        
        <p style="color: #9ca3af; font-size: 0.9rem; line-height: 1.5; margin: 0 0 15px;">
            @(string.IsNullOrEmpty(Model.Description) ? "M√≥n ƒÉn ngon t·ª´ FastFood Shop" : Model.Description)
        </p>
        
        <div style="font-size: 1.5rem; font-weight: 800; color: #fbbf24; margin: 0 0 20px;">
            @Model.Price.ToString("N0") ‚Ç´
        </div>
        
        <button onclick="addToCart(@Model.Id); closeFoodModal();"
                style="width: 100%; padding: 14px; background: linear-gradient(135deg, #ff6b6b, #ee5a24); border: none; border-radius: 12px; color: #fff; font-size: 1rem; font-weight: 700; cursor: pointer;">
            üõí Th√™m v√†o gi·ªè h√†ng
        </button>
        
        <!-- Reviews Section -->
        @if (reviewCount > 0)
        {
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                <h4 style="color: #fff; font-size: 1rem; margin-bottom: 15px;">üí¨ ƒê√°nh gi√° t·ª´ kh√°ch h√†ng</h4>
                <div style="max-height: 200px; overflow-y: auto;">
                    @foreach (var review in Model.Reviews!.OrderByDescending(r => r.CreatedAt).Take(5))
                    {
                        <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 12px; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                                <span style="color: #60a5fa; font-weight: 600; font-size: 0.85rem;">
                                    @(review.User?.FullName ?? "Kh√°ch h√†ng")
                                </span>
                                <span style="color: #fbbf24; font-size: 0.8rem;">
                                    @for (int i = 1; i <= review.Rating; i++) { @("‚òÖ") }
                                </span>
                            </div>
                            @if (!string.IsNullOrEmpty(review.Comment))
                            {
                                <p style="color: #94a3b8; font-size: 0.85rem; margin: 0; line-height: 1.4;">
                                    @review.Comment
                                </p>
                            }
                            <span style="color: #6b7280; font-size: 0.75rem; display: block; margin-top: 6px;">
                                @review.CreatedAt.ToString("dd/MM/yyyy")
                            </span>
                        </div>
                    }
                </div>
            </div>
        }
        else
        {
            <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.03); border-radius: 10px; text-align: center;">
                <span style="color: #6b7280; font-size: 0.85rem;">Ch∆∞a c√≥ ƒë√°nh gi√° cho m√≥n n√†y</span>
            </div>
        }
    </div>
</div>